<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8" />
		<title>Hueveras de cartón 2</title>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/phaser/3.87.0/phaser.min.js"></script>
		<script>

			let canvas_w = 800;
			let canvas_y = 450;

			let config =
			{
				width: canvas_w,
				height: canvas_y,
				scene:
				{
					preload: precarga,
					create: crea,
					update: actualiza
				}
			};

			let game = new Phaser.Game(config);

			let flechas;
			let huevera_b, huevera_m, huevera_d;
			let huevo_b, huevo_m, huevo_d;
			let canvas_bg;
			let huevosFalling;

			function precarga() {
				this.load.image('huevera', 'recursos/huevera.png');
				this.load.image('huevo', 'recursos/huevo.png');
				this.load.image('fondo', 'recursos/fondo.png');
			}

			function crea() {
				flechas = this.input.keyboard.createCursorKeys();

				canvas_bg = this.add.image(canvas_w / 2, canvas_y / 2, 'fondo');

				huevera_b = this.add.image(140, 100, 'huevera').setScale(0.75);
				huevera_m = this.add.image(140, 225, 'huevera').setScale(0.75).setTint(Phaser.Display.Color.GetColor(255, 128, 16));
				huevera_d = this.add.image(140, 350, 'huevera').setScale(0.75).setTint(Phaser.Display.Color.GetColor(255, 229, 122));

				huevo_b = this.add.image(450, 225, 'huevo').setScale(1);
				huevo_m = this.add.image(550, 225, 'huevo').setScale(1).setTint(Phaser.Display.Color.GetColor(255, 128, 16));
				huevo_d = this.add.image(650, 225, 'huevo').setScale(1).setTint(Phaser.Display.Color.GetColor(255, 229, 122));

				huevo_b.setInteractive({ draggable: true });
				huevo_m.setInteractive({ draggable: true });
				huevo_d.setInteractive({ draggable: true });

				huevo_b.on('pointerdown', function () {
					console.log("Huevo blanco clickado");
				});

				huevo_m.on('pointerdown', function () {
					console.log("Huevo marrón clickado");
				});

				huevo_d.on('pointerdown', function () {
					console.log("Huevo dorado clickado");
				});
				
				this.input.on('drag', function (pointer, object, x, y) {
					object.x = x;
					object.y = y;
					object.setScale(1.35);

					if (Phaser.Geom.Intersects.RectangleToRectangle(huevera_m.getBounds(), object.getBounds())) {
						console.log("Huevo dentro de huevera!!");
					}
				});

				this.input.on('dragend', function (pointer, object, x, y) {
					object.setScale(1);
				});

				huevosFalling = this.physics.add.group();

				this.time.addEvent({
					delay: 1000,
					callback: generarHuevo,
					callbackScope: this,
					loop: true
				});
			}

			function generarHuevo() {
				let x = Phaser.Math.Between(300, 700);
				let huevo = huevosFalling.create(x, 50, 'huevo').setScale(0.75);

				let colorRandom = Phaser.Math.Between(1, 3);
				if (colorRandom === 1) {
					huevo.setTint(Phaser.Display.Color.GetColor(255, 255, 255));
				} else if (colorRandom === 2) {
					huevo.setTint(Phaser.Display.Color.GetColor(255, 128, 16));
				} else {
					huevo.setTint(Phaser.Display.Color.GetColor(255, 229, 122));
				}

				huevo.setVelocityY(100);
			}

			function actualiza() {
				huevosFalling.children.iterate(function (huevo) {
					if (huevo.y > canvas_y) {
						huevo.destroy();
					}
				});
			}

		</script>
	</head>
	<body>
	</body>
</html>
